#!/usr/bin/env tclsh

package require Tcl 8

set serverName [lindex $::argv 0]
set bufferName [lindex $::argv 1]

set bufferSize 4096

while {![eof stdin]} {
    set input [read stdin $bufferSize]
    puts -nonewline $input
    exec rmacs --name $serverName eval "(with-current-buffer (get-buffer-create \"$bufferName\")
  (save-excursion
    (goto-char (point-max))
    (insert \"$input\")))
  " 2>@ stderr
}
